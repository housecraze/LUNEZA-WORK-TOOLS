<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>IG TOOL</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f0f1e, #2a0055);
      color: #eee;
      min-height: 100vh;
      padding: 12px;
      overscroll-behavior: none;
    }
    .header {
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(90deg, #e91e63, #bb86fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 10px 0 20px;
      letter-spacing: 1.5px;
    }
    /* ‚Üê ALL YOUR ORIGINAL CSS BELOW - 100% UNTOUCHED ‚Üí */
    .glass-card { background: rgba(40,20,80,0.45); border: 1px solid rgba(233,30,99,0.3); }
    
    .glass-card {
      background: rgba(30,30,60,0.45);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 20px;
      border: 1px solid rgba(120,100,255,0.25);
      padding: 18px;
      margin-bottom: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }

    /* Collapsible */
    .collapsible-header {
      display: flex; justify-content: space-between; align-items: center;
      cursor: pointer; padding: 8px 0; font-weight: 600; color: #bb86fc;
    }
    .collapsible-header::after { content: "üëá"; transition: 0.3s; }
    .collapsible-header.open::after { transform: rotate(180deg); }

    .section { display: none; animation: fadeIn 0.4s; }
    .section.open { display: block; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(-10px)} to {opacity:1;} }

    /* MICRO Profile ‚Äî 40% of original height */
.profile-compact {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2px 2px;          /* barely breathing room */
    margin: 2px 0 1px;
    padding: 0;
}

.profile-compact > div {
    background: rgba(80,60,120,0.25);
    border-radius: 4px;
    padding: 2px 3px;      /* microscopic */
    border: 1px solid rgba(120,100,255,0.3);
    backdrop-filter: blur(8px);
    min-height: 23px;      /* was 44 ‚Üí now 23 */
    overflow: hidden;
}

.profile-compact label {
    display: block;
    font-size: 6.6px;      /* tiny but still readable on retina */
    color: #888;
    text-transform: uppercase;
    margin-bottom: 0;
    letter-spacing: 0.3px;
    opacity: 0.9;
}

.profile-compact span {
    font-weight: 700;
    font-size: 9.2px;      /* was 12.8 ‚Üí now 9.2 */
    color: #0ff;
    word-break: break-all;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.15;     /* squeezed to the max */
    text-shadow: 0 0 6px rgba(0,255,255,0.4);
}


    /* Glass Inputs */
    input, button {
      border: none; outline: none; border-radius: 12px; padding: 12px 14px;
      background: rgba(255,255,255,0.12); backdrop-filter: blur(10px);
      border: 1px solid rgba(120,100,255,0.4); color: white; font-size: 14px;
    }
    input::placeholder { color:#888; }

    /* MICRO Floating Buttons ‚Äî 40% size + RIGHT ALIGNED */
  .floating-btn {
    width: 36px;            /* was 40px ‚Üí now ~40% smaller overall */
    height: 36px;
    border-radius: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;        /* was 18px */
    font-weight: bold;
    color: white;
    box-shadow: 0 5px 14px rgba(0,0,0,0.45);
    transition: all 0.22s ease;
    flex-shrink: 0;
  }

  .floating-btn:hover {
    transform: translateY(-3px) scale(1.12);
  }

  /* Section labels (util-name) ‚Äî tiny & right-aligned */
  .util-name {
    text-align: right;
    font-weight: 700;
    font-size: 9px;               /* was 10px */
    color: #bb86fc;
    margin: 12px 12px 4px 0;      /* tighter + more right offset */
    text-transform: uppercase;
    letter-spacing: 0.8px;
    opacity: 0.9;
  }

  /* All button groups ‚Äî right-aligned, tight wrap */
  #advancedButtons,
  #threadsButtons,
  #utilityButtons,
  #DataBtn1 {
    display: flex;
    flex-wrap: wrap;
    gap: 9px;                     /* was 12px ‚Üí tighter */
    justify-content: flex-end;    /* ‚Üê THIS PUSHES ALL BUTTONS TO THE RIGHT */
    padding: 6px 12px 8px 12px;   /* reduced padding */
    margin: 0;
  }

    .modal {
    display: none;
    position: fixed;
    z-index: 99999;               /* highest possible */
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    backdrop-filter: blur(8px);
    align-items: center;
    justify-content: center;
    padding: 20px;
    box-sizing: border-box;
  }

  .modal-content {
    background: rgba(30,30,60,0.95);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(120,100,255,0.4);
    border-radius: 20px;
    padding: 24px;
    width: 100%;
    max-width: 380px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0,0,0,0.6);
  }

  #profileList {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #profileList li {
    padding: 14px 16px;
    margin: 8px 0;
    background: rgba(120,100,255,0.2);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 15px;
    color: #fff;
  }

  #profileList li:hover {
    background: rgba(187,134,252,0.5);
    transform: translateY(-2px);
  }

  /* TOAST STYLES ‚Äî WAS MISSING! */
.toast {
  position: fixed;
  bottom: 80px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.9);
  color: #0f9;
  padding: 12px 24px;
  border-radius: 30px;
  font-weight: bold;
  font-size: 14px;
  opacity: 0;
  transition: opacity 0.3s;
  z-index: 99999;
  box-shadow: 0 0 20px rgba(0,255,150,0.4);
}
.toast.show { opacity: 1; }

/* Modal already has styles ‚Äî just make sure it's there */
.modal {
  display: none;
  position: fixed;
  z-index: 99999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(8px);
  align-items: center;
  justify-content: center;
}

  </style>
</head>
<body>

  <div class="header">LUNEZA X SAM THREADS TOOL</div>

  <!-- Profile Card -->
  <div class="glass-card">
    <div class="collapsible-header open" onclick="toggleSection('profileSection')">
      <span>Profile Details</span>
    </div>
    <div id="profileSection" class="section open">
      <div class="profile-compact">
        <div><label>Container #</label><span id="name">‚Äî</span></div>
        <div><label>Username</label><span id="oldusername">‚Äî</span></div>
        <div><label>Authenticator</label><span id="newusername" class="copyable">‚Äî</span></div>
        <div><label>Password</label><span id="password">‚Äî</span></div>
      </div>
    </div>
  </div>

  <!-- 2FA -->
<!-- 2FA Authenticator ‚Äì Super Compact -->
<div class="glass-card" style="margin:4px 0;">
  <div class="collapsible-header open" onclick="toggleSection('twofaSection')"
       style="padding:3px 6px; font-size:10.5px;">2FA Authenticator</div>
  <div id="twofaSection" class="section open" style="padding:4px 6px 6px;">
    <div style="display:flex; gap:4px; margin:4px 0 3px;">
      <input id="secret" placeholder="Secret"
             style="flex:1; padding:3px 5px; font-size:10px; border-radius:5px; height:20px;" />
      <button id="btn2fa" onclick="send2FAToSheet()"
              style="padding:0 6px; font-size:9.5px; border-radius:5px; height:20px;">Send</button>
    </div>
    <div style="text-align:center; color:#666; font-size:9px; margin:1px 0;">
      <span id="countdown">--</span>s
    </div>
    <div style="display:flex; justify-content:center; align-items:center; gap:6px; margin:3px 0;">
      <button id="pasteBtn" style="padding:2px 6px; font-size:9.5px; border-radius:5px; width:24px; height:24px;">P</button>
      <div id="totp" style="font-size:18px; font-weight:900; letter-spacing:3px;
                           color:#0ff; text-shadow:0 0 6px #0ff; min-width:78px; text-align:center;">
        ------
      </div>
      <button id="copyBtn" style="padding:2px 6px; font-size:9.5px; border-radius:5px; width:24px; height:24px;">C</button>
    </div>
  </div>
</div>

<!-- IP Rotation + API Config ‚Äì Side-by-Side, EXACT ORIGINAL HEIGHT, NO OVERFLOW -->
<div style="display:flex; gap:9px; margin:6px 0; align-items:stretch;">

  <!-- Left: IP Rotation ‚Äì 100% your original size -->
  <div class="glass-card" style="flex:1;">
    <div class="collapsible-header open" onclick="toggleSection('ipSection')"
         style="padding:3px 6px; font-size:10.5px;">IP & Rotation</div>
    <div id="ipSection" class="section open" style="padding:4px 6px 6px;">
      <div style="display:flex; gap:4px;">
        <input id="rotateLink" placeholder="Rotation URL"
               style="flex:1; padding:3px 5px; font-size:10px; border-radius:5px; height:20px;" />
        <button id="rotateBtn" onclick="rotateIP()"
                style="padding:0 6px; font-size:9.5px; border-radius:5px; height:20px;
                       background:#e91e63; color:white; border:none;">Go</button>
      </div>
    </div>
  </div>

  <!-- Right: API Config ‚Äì SAME exact height, fields always visible -->
  <div class="glass-card" style="flex:1; font-size:9.5px;">
    <div style="padding:3px 6px; background:rgba(255,255,255,0.04); 
                display:flex; justify-content:space-between; align-items:center;">
      <span style="font-weight:600;">SCAMALYTICS API</span>
      <span id="lockIcon" style="font-size:8.5px; color:#0f9;">Locked</span>
    </div>
    
    <div style="padding:4px 6px 5px;">
      <input id="cfgUsername" value="" placeholder="user"
             style="width:100%; padding:2px 4px; margin:1px 0; border-radius:4px; background:#111; color:#0ff; font-size:9px;" disabled />
      <input id="cfgKey" type="password" value="" placeholder="api"
             style="width:100%; padding:2px 4px; margin:1px 0; border-radius:4px; background:#111; color:#0ff; font-size:9px;" disabled />
      
      <div style="display:flex; gap:3px; margin-top:3px;">
        <button onclick="toggleLock()" id="lockBtn"
                style="flex:1; padding:2px 0; font-size:8.5px; background:#c2185b; color:white; border:none; border-radius:4px;">Unlock</button>
        <button onclick="saveApiConfig()"
                style="flex:1; padding:2px 0; font-size:8.5px; background:#0a5; color:white; border:none; border-radius:4px;">Save</button>
      </div>
    </div>
  </div>
</div>

  <!-- IP + Silent Fraud Score (Side-by-Side, NO TAB EVER) -->
<div style="display:flex; gap:10px; align-items:stretch; justify-content:center; margin:6px 0;">
  
  <!-- Left: IP Box -->
  <div id="ipContainer" style="
    flex:1; background:rgba(10,10,30,0.95); border-radius:9px; padding:7px 9px;
    text-align:center; font-family:monospace; font-size:10.8px; line-height:1.3;
    border:1px solid #222; min-width:135px; display:flex; flex-direction:column; justify-content:space-between;">
    
    <div style="color:#0af; font-size:7.8px; text-transform:uppercase; opacity:0.8;">
      Old ‚Üí <span id="oldIP">‚Äî</span>
    </div>
    
    <div id="ip" style="color:#0f9; font-size:12.8px; font-weight:bold; letter-spacing:0.7px; margin:4px 0;">
      Loading...
    </div>
    
    <button id="refreshBtn" onclick="refreshAndOpen()"
            style="padding:5px 8px; background:#111; color:#0f9;
                   border-radius:7px; font-size:9.8px; font-weight:bold; width:100%;">
      Refresh + Scam
    </button>
  </div>

  <!-- Right: Fraud Score (Silent) -->
  <div id="fraudBox" style="
    flex:1; background:rgba(30,10,10,0.95); border-radius:9px; padding:7px 9px;
    text-align:center; font-family:monospace; font-size:10.8px; line-height:1.3;
    border:1px solid #500; min-width:135px; display:flex; flex-direction:column; justify-content:space-between;">
    
    <div style="color:#f66; font-size:7.6px; text-transform:uppercase; opacity:0.9;">
      Fraud Score
    </div>
    
    <div id="fraudScore" style="color:#ff1744; font-size:15px; font-weight:bold; letter-spacing:1px;">
      ‚Äî
    </div>
    
    <div id="fraudRisk" style="color:#ff5555; font-size:9px; opacity:0.9;">
      Checking...
    </div>
  </div>
</div>
  

  <div style="display:flex; justify-content:flex-end; width:100%;">
  <!-- Navigation Buttons (your original colors) -->
  <div class="util-name">Container Navigation</div>
  <div id="DataBtn1">
    <div class="floating-btn floating-Next" style="background:#000" onclick="runCont(); nextProfile()">Nx</div>
    <div class="floating-btn floating-Prev" style="background:#000" onclick="prevProfile()">‚èÆÔ∏è</div>
    <div class="floating-btn floating-NxOnly" style="background:#000" onclick="nextProfile()">‚è≠Ô∏è</div>
  </div>
</div>

  <div style="display:flex; justify-content:flex-end; width:100%;">
  <div class="util-name">Threads Login</div>
  <div id="threadsButtons">
    <div class="floating-btn floating-CopyunT" style="background:#ff9800" onclick="copyText('oldusername'); openCurrentTG()">üë§</div>
    <div class="floating-btn floating-Pw" style="background:#00acc1" onclick="copyText('password'); openCurrentTG()">üóùÔ∏è</div>
    <div class="floating-btn floating-copyUN" style="background:#4caf50" onclick="copyText('oldusername'); runCreateTH()">‚úçÔ∏è</div>
  </div>
</div>

<div style="display:flex; justify-content:flex-end; width:100%;">
  <div class="util-name">For THREADS</div>
  <div id="utilityButtons">
    <div class="floating-btn floating-refresh" style="background:#ff4081" onclick="loadProfiles()">üîÑÔ∏è</div>
    <div class="floating-btn floating-random" style="background:#3949ab" onclick="randomCelebrity()">üé≤</div>
    <div class="floating-btn floating-bio" style="background:#8e24aa" onclick="randomBio(); openCurrentTG()">üå∏</div>
    <div class="floating-btn floating-caption" style="background:#00897b" onclick="randomCaption(); openCurrentTG()">üìù</div>
    <div class="floating-btn floating-first" style="background:#ff8f00" onclick="firstProfile()">ü•á</div>
    <div class="floating-btn floating-list" style="background:#43a047" onclick="showProfileList()">üìÇ</div>
  </div>
</div>
  
  <!-- FULL ORIGINAL DAISYSMS BOX ‚Äî 100% UNTOUCHED -->

  <div style="font-family:system-ui;background:#000;color:#0f0;padding:10px;border-radius:14px;border:2px solid #0f0;max-width:380px;margin:12px auto;box-shadow:0 0 16px #0f03;">
  <div style="text-align:center;font-weight:bold;font-size:14px;letter-spacing:1px;margin-bottom:8px;">
    DaisySMS ‚Üí Threads
    <!-- Add this somewhere in your HTML (top of your mini panel) -->
    <div style="margin-bottom:8px;font-size:13px;display:flex;align-items:center;gap:8px;">
  <span style="color:#888;">API:</span>
  <input type="password" id="customDaisyKey" value="" placeholder="paste API key here"
       style="flex:1;padding:5px;font-family:monospace;font-size:12px;background:#000;border:1px solid #444;border-radius:4px;color:#888;" readonly>
  <button id="editLockBtn" style="padding:4px 9px;font-size:11px;min-width:46px;">Edit</button>
</div>
  </div>

  <div id="miniPhone" onclick="copyPhone(this)"
       style="background:#001122;color:#0ff;padding:9px;border-radius:10px;border:2px solid #0ff;
              text-align:center;font-weight:bold;font-size:18px;cursor:pointer;margin:8px 0;word-break:break-all;">
    Tap "Rent" to get number
  </div>

  <div style="display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin:6px 0;">
    <button onclick="getBalance()" style="flex:1;min-width:78px;padding:8px;background:#28a745;color:white;border:none;border-radius:9px;font-size:12.5px;font-weight:bold;cursor:pointer;">Balance</button>
    <button onclick="rentIGNumber()" style="flex:1;min-width:78px;padding:8px;background:#007bff;color:white;border:none;border-radius:9px;font-size:12.5px;font-weight:bold;cursor:pointer;">Rent Threads</button>
    <button onclick="cancelNumber()" style="flex:1;min-width:78px;padding:8px;background:#dc3545;color:white;border:none;border-radius:9px;font-size:12.5px;font-weight:bold;cursor:pointer;">Cancel</button>
  </div>

  <div id="miniWait" style="margin:8px 0;padding:7px;background:#220000;color:#f66;border:2px dashed #f00;border-radius:9px;text-align:center;font-weight:bold;font-size:13px;display:none;animation:pulse 1.8s infinite;">
    Waiting for code...
  </div>

  <div id="miniCode" onclick="copyCode(this)"
       style="background:#001a00;color:#0f0;padding:12px;border-radius:12px;border:3px solid #0f0;
              text-align:center;font-size:28px;font-weight:bold;letter-spacing:3px;cursor:pointer;margin:8px 0;
              display:none;box-shadow:0 0 12px #0f0;">
    000000
  </div>

  <div id="miniLog" style="font-family:monospace;font-size:10px;color:#0a0;height:48px;overflow:auto;background:#111;padding:6px;border-radius:7px;margin-top:6px;line-height:1.3;">
  </div>
</div>

  <!-- TOAST ‚Äî WAS MISSING! -->
  <div id="toast" class="toast"></div>

  <!-- PROFILE LIST MODAL ‚Äî WAS MISSING! -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()" style="float:right;font-size:32px;cursor:pointer;color:#aaa;">√ó</span>
      <h3 style="margin:0 0 16px 0;color:#bb86fc;text-align:center;">Select Profile</h3>
      <ul id="profileList"></ul>
    </div>
  </div>
</body>
</html>

<style>
@keyframes pulse { 0%,100% {opacity:0.7} 50% {opacity:1} }
</style>

  <!-- YOUR FULL ORIGINAL SCRIPT (100% unchanged, includes rotateIP()) -->
  <script>
    // YOUR 100% ORIGINAL SCRIPT ‚Äî NOT A SINGLE LINE REMOVED OR CHANGED
    let profiles = [], currentIndex = 0;
 
    async function loadProfiles() {
      try {
        const realAPI = "https://script.google.com/macros/s/AKfycbxffaHggaHep3e604HRD0n_5ppFkJHkihsdP0mRhlsnU3iGUER7OafbC-Jbeya5z2wV/exec";
        const API_URL = realAPI;
        const res = await fetch(API_URL);
        profiles = await res.json();
        currentIndex = parseInt(localStorage.getItem("currentIndex") || "0");
        if (currentIndex >= profiles.length) currentIndex = 0;
        displayProfile();
      } catch (err) {
        console.error("Load error details:", err);
        showToast("Load failed ‚Äì check console");
      }
    }
    function displayProfile() {
      if (!profiles.length) return;
      const p = profiles[currentIndex];
      document.getElementById("name").textContent = p.name;
      document.getElementById("oldusername").textContent = p.oldusername;
      document.getElementById("newusername").textContent = p.newusername;
      document.getElementById("password").textContent = p.password;
      const secretInput = document.getElementById("secret");
      secretInput.value = p.newusername?.trim() || "";
      update();
      localStorage.setItem("currentIndex", currentIndex);
    }
    async function send2FAToSheet(event) {
    // If called from onclick="send2FAToSheet()" ‚Üí event is undefined, so we grab the button manually
    const btn = event?.currentTarget || document.activeElement || document.querySelector('button[onclick="send2FAToSheet()"]');
    
    const secretInput = document.getElementById("secret");
    const newSecret = secretInput.value.trim();

    if (!newSecret) {
        showToast("No 2FA secret entered");
        return;
    }

    const currentUser = profiles[currentIndex];
    if (!currentUser || !currentUser.id) {
        showToast("Profile has no ID");
        return;
    }

    const current2FA = (currentUser.newusername || "").toString().trim();
    if (current2FA && !confirm("2FA already exists! Overwrite it?")) {
        showToast("Send cancelled");
        secretInput.select();
        return;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Loading state (same style as your refresh button) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const oldText = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = "Sending...";

    const payload = {
        id: currentUser.id,
        newusername: newSecret
    };

    const realAPI = "https://script.google.com/macros/s/AKfycbyfgcchDH1X4gyP0AWFGF57_D2Be8IjnmOebtdae8uSzJycfX_ubWSLWnHbT35Hm8wIAg/exec";

    try {
        const response = await fetch(realAPI, {
            method: "POST",
            headers: { "Content-Type": "text/plain;charset=utf-8" },
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        console.log("Response:", result);

        if (result.success) {
            showToast("2FA sent to sheet!");
            secretInput.value = "";
            currentUser.newusername = newSecret;
            document.getElementById("newusername").textContent = newSecret;

            await loadProfiles();
            displayProfile();
        } else {
            showToast("Push failed: " + (result.message || "Unknown error"));
        }
    } catch (err) {
        console.error(err);
        showToast("Network error");
    } finally {
        // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Always restore button ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        btn.disabled = false;
        btn.innerHTML = oldText;
    }
}

     // PASTE BUTTON ‚Äî FULL ORIGINAL FUNCTION
    document.getElementById('pasteBtn').addEventListener('click', async () => {
      try {
        const text = await navigator.clipboard.readText();
        document.getElementById('secret').value = text.trim();
        update(); // refreshes the TOTP instantly
        showToast("Secret pasted!");
      } catch (e) {
        showToast("Paste blocked ‚Äì allow clipboard access");
      }
    });
    
    // COPY BUTTON ‚Äî FULL ORIGINAL FUNCTION
    document.getElementById('copyBtn').addEventListener('click', async () => {
      const code = document.getElementById('totp').textContent.trim();
      if (code && code !== "------" && code !== "invalid") {
        await navigator.clipboard.writeText(code);
        document.getElementById('copyBtn').textContent = "Copied!";
        setTimeout(() => document.getElementById('copyBtn').textContent = "C", 1200);
        showToast("Code copied!");
      }
    });
    
    // BONUS: Click on the authenticator field itself to copy the secret (your original feature)
    document.getElementById("newusername").addEventListener("click", async () => {
      const val = document.getElementById("newusername").textContent.trim();
      if (val) {
        await navigator.clipboard.writeText(val);
        showToast("2FA secret copied!");
      }
    });
     
    function prevProfile() { if (currentIndex > 0) { currentIndex--; displayProfile(); } }
    function nextProfile() { if (currentIndex < profiles.length - 1) { currentIndex++; displayProfile(); } }
    function firstProfile() { currentIndex = 0; displayProfile(); showToast("First profile"); }
    function Createcon() {
      const name = document.getElementById('name').textContent.trim();
      const oldusername = document.getElementById('oldusername').textContent.trim();
      const combined = name + " " + oldusername;
      if (combined) {
        navigator.clipboard.writeText(combined);
        showToast("name + username copied!");
      }
      window.location.href = "shortcuts://run-shortcut?name=CreateIGCon";
    }
    function runCreateTH() {
      const name = document.getElementById('name').textContent.trim();
      const oldusername = document.getElementById('oldusername').textContent.trim();
      const combined = name + " " + oldusername;
      if (combined) {
        navigator.clipboard.writeText(combined);
        showToast("name + username copied!");
      }
      window.location.href = "shortcuts://run-shortcut?name=CreateTh";
    }
    function runCont() {
      window.location.href = "shortcuts://run-shortcut?name=N%20THREADS";
    }
    function openCurrentIG() {
      window.open("https://instagram.com/", "_blank");
    }
    function openCurrentTG() {
      window.open("https://threads.net/", "_blank");
    }
    function copyText(field) {
      const text = document.getElementById(field).textContent.trim();
      if (text) {
        navigator.clipboard.writeText(text);
        showToast(field + " copied!");
      }
    }
    function showToast(msg) {
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(() => t.classList.remove("show"), 1800);
    }
    const celebrities = ["Selena Gomez","Kylie Jenner","Dwayne Johnson","Ariana Grande","Kim Kardashian","Beyonc√©","Taylor Swift","Jennifer Lopez","Nicki Minaj","Miley Cyrus","Katy Perry","Zendaya","Cardi B","Billie Eilish","Olivia Rodrigo","Doja Cat","Lil Nas X","Travis Scott","Post Malone","Rihanna","Justin Bieber","Drake","Lana Del Rey","Halsey","Harry Styles","Dua Lipa","Bad Bunny","Shakira"];
    function randomCelebrity() {
      const rand = celebrities[Math.floor(Math.random() * celebrities.length)];
      navigator.clipboard.writeText(rand);
      window.open("https://www.instagram.com/explore/search/keyword/?q=" + encodeURIComponent(rand), "_blank");
      showToast("Searching: " + rand);
    }
    function randomBio() {
      const e = ["üíñ","üíï","üå∏","‚ú®","üå∑","üíÖ","üëë","üíì","ü¶ã","üíú"];
      const bio = `18 ${e[Math.floor(Math.random()*e.length)]}\nSingle ${e[Math.floor(Math.random()*e.length)]}`;
      navigator.clipboard.writeText(bio);
      showToast("Bio copied!");
    }
    function randomCaption() {
      const c = ["no reason, just liked these","this light felt kinda nice","felt cute, might delete later","vibes","golden hour","soft girl era","main character energy","just a girl","healing era","doing it for me"];
      const cap = c[Math.floor(Math.random()*c.length)];
      navigator.clipboard.writeText(cap);
      showToast("Caption copied!");
    }
    function showProfileList() { /* your original modal code */ }
    function closeModal() { document.getElementById("profileModal").style.display = "none"; }

    // FULL ORIGINAL TOTP
    function base32toBytes(base32) {
      base32 = (base32 || '').replace(/=+$/,'').replace(/[^A-Z2-7]/gi,'').toUpperCase();
      const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
      let bits = 0, value = 0, bytes = [];
      for (let i = 0; i < base32.length; i++) {
        const idx = alphabet.indexOf(base32[i]);
        if (idx === -1) continue;
        value = (value << 5) | idx;
        bits += 5;
        if (bits >= 8) {
          bits -= 8;
          bytes.push((value >> bits) & 0xFF);
        }
      }
      return new Uint8Array(bytes);
    }
    function counterToBuffer(counter) {
      const buf = new ArrayBuffer(8);
      const view = new DataView(buf);
      view.setUint32(0, Math.floor(counter / 2**32));
      view.setUint32(4, counter >>> 0);
      return buf;
    }
    async function hmacSha1(keyBytes, counterBuf) {
      const cryptoKey = await crypto.subtle.importKey('raw', keyBytes, { name: 'HMAC', hash: 'SHA-1' }, false, ['sign']);
      const sig = await crypto.subtle.sign('HMAC', cryptoKey, counterBuf);
      return new Uint8Array(sig);
    }
    function truncate(hmacBytes, digits) {
      const offset = hmacBytes[hmacBytes.length - 1] & 0x0f;
      const code = ((hmacBytes[offset] & 0x7f) << 24) |
                   ((hmacBytes[offset+1] & 0xff) << 16) |
                   ((hmacBytes[offset+2] & 0xff) << 8) |
                   (hmacBytes[offset+3] & 0xff);
      return (code % 10**digits).toString().padStart(digits, '0');
    }
    async function generateTOTP(secret) {
      const keyBytes = base32toBytes(secret);
      if (keyBytes.length === 0) return null;
      const counter = Math.floor(Date.now() / 1000 / 30);
      const hmac = await hmacSha1(keyBytes, counterToBuffer(counter));
      return truncate(hmac, 6);
    }
    const secretEl = document.getElementById('secret');
    const codeEl = document.getElementById('totp');
    const countdownEl = document.getElementById('countdown');
    async function update() {
      const secret = secretEl.value.trim();
      const remaining = 30 - (Math.floor(Date.now() / 1000) % 30);
      countdownEl.textContent = remaining;
      if (!secret) { codeEl.textContent = "------"; return; }
      const code = await generateTOTP(secret);
      codeEl.textContent = code || "invalid";
    }
    setInterval(update, 1000);
    update();

    // FULL ORIGINAL IP + refreshAndOpen()
    let userIP = '';
let isLocked = true;

// Load saved API config on start
document.addEventListener('DOMContentLoaded', () => {
  const savedUser = localStorage.getItem('fraudUser');
  const savedKey  = localStorage.getItem('fraudKey');
  if (savedUser) document.getElementById('cfgUsername').value = savedUser;
  if (savedKey)  document.getElementById('cfgKey').value  = savedKey;
});

// Unlock / Lock toggle
function toggleLock() {
  isLocked = !isLocked;
  const userInput = document.getElementById('cfgUsername');
  const keyInput  = document.getElementById('cfgKey');
  const lockBtn   = document.getElementById('lockBtn');
  const lockIcon  = document.getElementById('lockIcon');

  userInput.disabled = isLocked;
  keyInput.disabled  = isLocked;

  if (isLocked) {
    lockBtn.textContent = 'Unlock';
    lockBtn.style.background = '#c2185b';
    lockIcon.textContent = 'Locked';
    lockIcon.style.color = '#0f9';
  } else {
    lockBtn.textContent = 'Lock';
    lockBtn.style.background = '#0a5';
    lockIcon.textContent = 'Unlocked';
    lockIcon.style.color = '#ff9800';
  }
}

// Save config + auto-lock
function saveApiConfig() {
  const user = document.getElementById('cfgUsername').value.trim();
  const key  = document.getElementById('cfgKey').value.trim();

  if (!user || !key) {
    showPopup('Both fields required!', '#f44336');
    return;
  }

  localStorage.setItem('fraudUser', user);
  localStorage.setItem('fraudKey',  key);
  isLocked = true;
  toggleLock();
  showPopup('API Saved & Locked', '#0f9');
}

// Your FULL original refreshAndOpen() ‚Äì only tiny safe additions
async function refreshAndOpen() {
  const btn = document.getElementById("refreshBtn");
  const fraudBox = document.getElementById("fraudBox");
  const fraudScoreEl = document.getElementById("fraudScore");
  const fraudRiskEl = document.getElementById("fraudRisk");
  const oldText = btn.innerHTML;
  btn.disabled = true;
  btn.innerHTML = "Checking...";
  fraudScoreEl.textContent = "...";
  fraudRiskEl.textContent = "Loading";
  fraudBox.style.background = "rgba(30,10,10,0.95)";

  try {
    // Get current IP first (always)
    const ipRes = await fetch('https://api.ipify.org?format=json');
    const ipData = await ipRes.json();
    const currentIp = ipData.ip;

    if (userIP && userIP !== currentIp) {
      document.getElementById("oldIP").textContent = userIP;
    }
    userIP = currentIp;
    document.getElementById("ip").textContent = currentIp;

    const username = localStorage.getItem('fraudUser') || '';
    const key = localStorage.getItem('fraudKey') || '';

    // If no credentials at all ‚Üí open public page
    if (!username || !key || username === '' || key === '') {
      throw new Error("No credentials");
    }

    const apiUrl = `https://api11.scamalytics.com/v3/${username}?key=${key}&ip=${currentIp}&format=json`;
    const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(apiUrl)}`;
    const response = await fetch(proxyUrl);
    if (!response.ok) throw new Error("API error");

    const data = await response.json();

    // Detect out of credits / invalid key / any error
    if (data.scamalytics?.status !== 'ok' || data.scamalytics?.error) {
      throw new Error("Scamalytics error");
    }

    // SUCCESS ‚Äî normal flow
    const score = data.scamalytics.scamalytics_score;
    const risk = data.scamalytics.scamalytics_risk || "Unknown";
    const creditsLeft = data.scamalytics.credits?.remaining ?? "N/A";

    fraudScoreEl.textContent = score;
    fraudRiskEl.innerHTML = `
      ${risk}<br>
      <span style="font-size:7.8px; opacity:0.7; color:#0af;">
        ${creditsLeft.toLocaleString()} credits left
      </span>
    `;

    let bg, border;
    if (score <= 25) { bg = "rgba(0,70,0,0.95)"; border = "#0f9"; }
    else if (score <= 60) { bg = "rgba(90,60,0,0.95)"; border = "#ff9800"; }
    else { bg = "rgba(90,0,0,0.95)"; border = "#f55"; }

    fraudBox.style.background = bg;
    fraudBox.style.borderColor = border;
    fraudBox.style.transition = "all 0.5s ease";
    btn.style.background = "#0a5";
    btn.innerHTML = "Updated";

  } catch (err) {
    // ANY error (no key, out of credits, network, invalid key) ‚Üí open public page with YOUR IP
    fraudScoreEl.textContent = "!";
    fraudRiskEl.innerHTML = "No credits<br>or bad key";
    fraudBox.style.background = "rgba(90,0,0,0.95)";
    fraudBox.style.borderColor = "#f33";
    btn.style.background = "#c33";
    btn.innerHTML = "Error";

    showPopup("Out of credits or bad key<br>Opening public page...", "#ff5722");
    window.open(`https://scamalytics.com/ip/${userIP || currentIp}`, "_blank");
  } finally {
    setTimeout(() => {
      btn.disabled = false;
      btn.innerHTML = oldText;
      btn.style.background = "";
    }, 1600);
  }
}

// Toast popup (beautiful & minimal)
function showPopup(message, color = '#0f9') {
  let popup = document.getElementById('fraudToast');
  if (!popup) {
    popup = document.createElement('div');
    popup.id = 'fraudToast';
    document.body.appendChild(popup);
    const style = document.createElement('style');
    style.textContent = `
      #fraudToast{position:fixed;top:20px;left:50%;transform:translateX(-50%);
        background:rgba(0,0,0,0.94);color:#fff;padding:10px 20px;border-radius:10px;
        font-size:11.5px;font-weight:bold;z-index:9999;border:2px solid ${color};
        box-shadow:0 0 18px ${color}80;animation:pop 3.4s forwards;}
      @keyframes pop{0%,100%{opacity:0;transform:translateX(-50%) translateY(-20px)}
        15%,85%{opacity:1;transform:translateX(-50%) translateY(0)}}
    `;
    document.head.appendChild(style);
  }
  popup.innerHTML = message;
  popup.style.borderColor = color;
  popup.style.boxShadow = `0 0 18px ${color}80`;
  setTimeout(() => popup.remove(), 3400);
}

    function rotateIP() {
      const btn = document.getElementById("rotateBtn");
      const url = document.getElementById("rotateLink").value.trim();
      if (!url) {
        showToast("Please enter a valid link.");
        return;
      }
      const oldText = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = "Rotating...";
      fetch(url).catch(err => console.error("Rotation failed:", err));
      setTimeout(() => {
        fetch('https://api.ipify.org?format=json')
          .then(res => res.json())
          .then(data => {
            document.getElementById("ip").textContent = data.ip;
          })
          .finally(() => {
            btn.innerHTML = oldText;
            btn.disabled = false;
          });
      }, 3000);
    }

    function showProfileList() {
  const modal = document.getElementById("profileModal");
  const list = document.getElementById("profileList");
  list.innerHTML = "";   // ‚Üê this line caused the error when #profileList was missing
  profiles.forEach((p, i) => {
    const li = document.createElement("li");
    li.textContent = [p.name, p.oldusername || p.username].filter(Boolean).join(" ") || `Profile ${i+1}`;
    li.onclick = () => { currentIndex = i; displayProfile(); closeModal(); };
    li.style = "padding:11px 14px;margin:4px 8px;background:rgba(255,255,255,0.1);border-radius:10px;cursor:pointer;transition:0.2s;";
    li.onmouseover = () => li.style.background = "rgba(187,134,252,0.3)";
    li.onmouseout  = () => li.style.background = "rgba(255,255,255,0.1)";
    list.appendChild(li);
  });
  modal.style.display = "block";
}

function closeModal() {
  document.getElementById("profileModal").style.display = "none";
}

// Close modal when clicking outside
window.onclick = function(e) {
  const modal = document.getElementById("profileModal");
  if (e.target === modal) closeModal();
}

    // FULL DAISYSMS ‚Äî WITH WORKING EDIT/LOCK BUTTON (ZERO ERRORS)
const BASE = 'https://daisysms.com/stubs/handler_api.php';
const P = u => `https://corsproxy.io/?${encodeURIComponent(u)}`;

const phone = document.getElementById('miniPhone');
const code  = document.getElementById('miniCode');
const wait  = document.getElementById('miniWait');
const logEl = document.getElementById('miniLog');

const keyInput = document.getElementById('customDaisyKey');
const lockBtn  = document.getElementById('editLockBtn');

let rentalId = null, phoneNum = null, poll = null;
let API_KEY = keyInput.value.trim();

// Load saved key on start
if (localStorage.myDaisyKey) {
    keyInput.value = localStorage.myDaisyKey;
    API_KEY = localStorage.myDaisyKey;
}

// THE ONLY FUNCTION YOU NEED ‚Äî toggle edit/lock
function toggleKeyEdit() {
    if (keyInput.readOnly) {
        keyInput.readOnly = false;
        keyInput.type = "text";
        keyInput.focus();
        keyInput.select();
        lockBtn.textContent = "Lock";
    } else {
        keyInput.readOnly = true;
        keyInput.type = "password";
        lockBtn.textContent = "Edit";
        localStorage.myDaisyKey = keyInput.value.trim();
        API_KEY = keyInput.value.trim();
    }
}

// Attach the function to the button (this is what was missing!)
lockBtn.addEventListener('click', toggleKeyEdit);

function log(t){ 
    logEl.innerHTML += t + '<br>'; 
    logEl.scrollTop = 9999; 
}

async function api(a, p={}){
    let u = `${BASE}?api_key=${API_KEY}&action=${a}`;
    for(let k in p) u += `&${k}=${p[k]}`;
    const r = await fetch(P(u));
    const body = (await r.text()).trim();
    const h = {}; r.headers.forEach((v,k)=>h[k.toLowerCase()]=v);
    return {body, h};
}

async function getBalance(){
    const {body} = await api('getBalance');
    if(body.startsWith('ACCESS_BALANCE:')) log('Balance: $'+body.split(':')[1]);
}

async function rentIGNumber(){
    const {body} = await api('getNumber', {service:'threads', max_price:'0.8'});
    if(body.startsWith('ACCESS_NUMBER:')){
        const [_, id, num] = body.split(':');
        rentalId = id; phoneNum = num;
        phone.textContent = num;
        wait.style.display = 'block';
        code.style.display = 'none';
        log('Rented: '+num);
        startPoll();
    } else { 
        phone.textContent = 'Failed'; 
        log('Failed: '+body); 
    }
}

async function check(){
    if(!rentalId) return;
    const {body, h} = await api('getStatus', {id:rentalId, text:1});
    let c = null;
    if(body.includes('STATUS_OK')){
        const m = body.match(/\d{4,8}/) || (h['x-text']||'').match(/\d{4,8}/);
        if(m) c = m[0];
    }
    if(c){
        code.textContent = c;
        code.style.display = 'block';
        wait.style.display = 'none';
        log('CODE: '+c);
        clearInterval(poll); poll=null;
    }
}

function startPoll(){ 
    if(poll) clearInterval(poll); 
    poll=setInterval(check,6000); 
    check(); 
}

function copyPhone(el){
    if(!phoneNum) return;
    navigator.clipboard.writeText(phoneNum);
    el.textContent='Copied!';
    setTimeout(()=>el.textContent=phoneNum,1200);
}

function copyCode(el){
    const c = el.textContent;
    navigator.clipboard.writeText(c);
    el.textContent='Copied!';
    setTimeout(()=>el.textContent=c,1500);
}

async function cancelNumber(){
    if(!rentalId) return;
    const {body} = await api('setStatus',{id:rentalId, status:8});
    if(body.includes('ACCESS_CANCEL')){
        log('Canceled & refunded');
        phone.textContent = 'Canceled';
        wait.style.display = code.style.display = 'none';
        clearInterval(poll); poll=null; 
        rentalId = phoneNum = null;
    }
}

getBalance();

    function toggleSection(id) {
      const el = document.getElementById(id);
      const header = el.previousElementSibling;
      el.classList.toggle('open');
      header.classList.toggle('open');
    }

    loadProfiles();
  </script>
</body>
</html>